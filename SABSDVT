-- SDVT SAB #update - Rayfield menu robust
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
end)
if not success or not Rayfield then
    warn("Không tải được Rayfield.")
    return
end

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerName = (player and (player.DisplayName ~= "" and player.DisplayName or player.Name)) or "Player"

local ConfigFileName = "SDVT_SAB_Config"

local Window = Rayfield:CreateWindow({
    Name = "SDVT SAB",
    LoadingTitle = "SDVT SAB",
    LoadingSubtitle = "Menu",
    ConfigurationSaving = { Enabled = true, FileName = ConfigFileName },
    Discord = { Enabled=false },
})

-- Detect executor
local function detectExecutor()
    if type(identifyexecutor)=="function" then local ok,res=pcall(identifyexecutor) if ok and res then return tostring(res) end end
    if type(getexecutor)=="function" then local ok,res=pcall(getexecutor) if ok and res then return tostring(res) end end
    if type(syn)=="table" then return "Synapse" end
    if rawget(_G,"KRNL_LOADED") or rawget(_G,"Krnl") then return "Krnl" end
    if rawget(_G,"is_sirhurt_closure") then return "SirHurt/ScriptWare-like" end
    return "Unknown"
end
local executorName = detectExecutor()

-- ======================
-- Tab Info
-- ======================
local InfoTab, InfoSection
pcall(function()
    InfoTab = Window:CreateTab("Info")
    InfoSection = InfoTab:CreateSection("Giới thiệu & Người chơi")
end)
if InfoSection then
    pcall(function() InfoSection:CreateLabel("Tên script: SDVT SAB #update") end)
    pcall(function() InfoSection:CreateLabel("Tên người chơi: "..playerName) end)
    pcall(function() InfoSection:CreateLabel("Executor: "..executorName) end)
end

-- ======================
-- Tab Main
-- ======================
local MainTab, MainSection, countdownLabel
pcall(function()
    MainTab = Window:CreateTab("Main")
    MainSection = MainTab:CreateSection("Coming Soon")
end)
if MainSection then
    pcall(function() countdownLabel = MainSection:CreateLabel("……COMING SOON…….") end)
end

-- Countdown function
spawn(function()
    pcall(function()
        local targetTime = os.time{year=2025, month=10, day=27, hour=12, min=0, sec=0}
        while countdownLabel do
            local now = os.time()
            local diff = targetTime - now
            if diff <= 0 then
                countdownLabel.Text = "Đã đến thời gian!"
                break
            else
                local days = math.floor(diff/86400)
                local hours = math.floor((diff%86400)/3600)
                local minutes = math.floor((diff%3600)/60)
                local seconds = diff%60
                countdownLabel.Text = string.format("Còn %d ngày %02d:%02d:%02d", days, hours, minutes, seconds)
            end
            wait(1)
        end
    end)
end)

-- Auto load config
spawn(function()
    pcall(function()
        if Rayfield.LoadConfiguration then
            Rayfield:LoadConfiguration(ConfigFileName)
        elseif Rayfield.LoadConfig then
            Rayfield:LoadConfig(ConfigFileName)
        end
        if InfoSection then
            Rayfield:Notify({Title="Config Loaded", Content="Tự động load: "..ConfigFileName, Duration=4})
        end
    end)
end)

-- Ready notify
pcall(function()
    Rayfield:Notify({Title="SDVT SAB", Content="Menu đã sẵn sàng. Config SDVT_SAB_Config auto kích hoạt.", Duration=4})
end)
